# Library Management System - README

## 1. Introduction

    NAME:PACIFIQUE BAKUNDUKIZE
      STUDENT_ID: 26798
      PLUGGABLE DATABASE NAME : PDB26798
This README provides a**detailed** overview of the Library Management System project, describing:

1. The **problem statement** and the purpose of the system.
2. The **database schema**, including relationships and constraints.
3. The **SQL commands** executed (DDL, DCL, DML, TCL) and what each set of commands accomplishes.
4. **Sample queries**, their **results**, and how they address common library requirements.
5. **Transaction control** demonstrations using `SAVEPOINT`, `ROLLBACK`, and `COMMIT`.
6. **Screenshots** references (conceptual diagram, SQL query results, etc.) and **explanations** of outputs.

---

## 2. Problem Statement

A library typically manages:

- **Books** in different categories (e.g., Technology, Biography, History, etc.).
- **Authors** of those books, with the possibility that a book can have multiple authors (and an author can write multiple books).
- **Members** who borrow books, each having a profile with address and phone details.
- **Loan transactions** tracking which member borrowed which book, along with loan and return dates.

**Goal:**
Build a robust, relational database system in Oracle that captures these entities, enforces data integrity via constraints, and provides queries to retrieve insightful information about books, members, and loans. The system must also demonstrate how to manage transactions safely using Oracle’s transaction control features.

---

## 3. Database Schema Overview

Below is a summary of the **entities** (tables) and their relationships:

1. **Categories**

   - **Purpose**: Classify books (e.g., Technology, Biography, etc.).
   - **Primary Key**: `category_id` (generated by identity).
   - **Attributes**: `category_name`.
2. **Books**

   - **Purpose**: Stores each book’s details.
   - **Primary Key**: `book_id` (generated by identity).
   - **Attributes**: `title`, `publication_year`, `price`, `rating`, `category_id` (FK → `Categories`).
   - **Relationship**: Many books can belong to one category (one-to-many).
3. **Authors**

   - **Purpose**: Stores information about authors.
   - **Primary Key**: `author_id` (generated by identity).
   - **Attributes**: `name`, `bio`.
4. **BookAuthors**

   - **Purpose**: Resolves the many-to-many relationship between Books and Authors.
   - **Primary Key**: Composite (`book_id`, `author_id`).
   - **Foreign Keys**: `book_id` → `Books(book_id)`, `author_id` → `Authors(author_id)`.
5. **Members**

   - **Purpose**: Stores basic member information.
   - **Primary Key**: `member_id` (generated by identity).
   - **Attributes**: `name`, `email`, `membership_date`.
6. **MemberProfiles**

   - **Purpose**: Extended profile info for each member.
   - **Primary Key**: `member_id` (same as in `Members`).
   - **Attributes**: `address`, `phone`.
   - **Relationship**: One-to-one (each member has exactly one profile).
7. **Loans**

   - **Purpose**: Transaction table that records each borrowing event.
   - **Primary Key**: `loan_id` (generated by identity).
   - **Attributes**: `book_id` (FK), `member_id` (FK), `loan_date`, `return_date`, `created_at`.
   - **Relationship**: A single book can appear in many loan records, and a member can have many loans (two many-to-one relationships).

### Conceptual Diagram

Here is the conceptual diagram illustrating the tables, their attributes, and relationships:

![Conceptual Diagram]('/conceptual_diagram.png')

> *Screenshot 1: Conceptual ER diagram showing tables, primary keys, foreign keys, and relationships.*

---

## 4. SQL Scripts

All SQL commands are organized into **DDL**, **DCL**, **DML**, **TCL**, and **Queries**. They can be run in a single script or split across multiple files (e.g., `schema.sql`, `data.sql`, `queries.sql`, etc.).

### 4.1 DDL (Data Definition Language)

1. **Altering Session**

   ```sql
   ALTER SESSION SET CONTAINER = PDB26798;
   ```

   - Switches to the pluggable database (`PDB26798`) to ensure all subsequent operations occur in the correct container.
2. **Creating Tables**

   ```sql
   CREATE TABLE Categories (
       category_id   NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
       category_name VARCHAR2(100) NOT NULL
   );
   ```

   Similar statements for **Books**, **Authors**, **BookAuthors**, **Members**, **MemberProfiles**, and **Loans**. Each table definition includes constraints like **PRIMARY KEY** and **FOREIGN KEY** references.
3. **Foreign Key Constraints**

   - Example:
     ```sql
     CONSTRAINT fk_books_category
         FOREIGN KEY (category_id) REFERENCES Categories(category_id)
     ```
   - Ensures data integrity between **Books** and **Categories**.

### 4.2 DCL (Data Control Language)

1. **User Creation**

   ```sql
   CREATE USER bpacifique26798 IDENTIFIED BY "Euqificap12."
   QUOTA UNLIMITED ON USERS;
   ```

   Creates a new database user with a specified password and assigns an unlimited quota on the USERS tablespace.
2. **Granting Privileges**

   ```sql
   GRANT CREATE SESSION TO bpacifique26798;
   GRANT CREATE TABLE TO bpacifique26798;
   ```

   - Allows the new user to log in (`CREATE SESSION`) and create tables (`CREATE TABLE`).
3. **Object Privileges**

   ```sql
   GRANT SELECT, INSERT, UPDATE, DELETE ON Categories TO bpacifique26798;
   ```

   - Grants necessary DML permissions on each table to the new user.

### 4.3 DML (Data Manipulation Language)

1. **Inserting Data**

   - **Categories**:
     ```sql
     INSERT INTO Categories (category_name) VALUES ('Technology');
     INSERT INTO Categories (category_name) VALUES ('Biography');
     ...
     COMMIT;
     ```
   - **Books**:
     ```sql
     INSERT INTO Books (title, publication_year, category_id, price, rating)
     VALUES ('The Oracle of Delphi', 2018, 1, 29.99, 4.5);
     ...
     COMMIT;
     ```
   - **Authors**, **BookAuthors**, **Members**, **MemberProfiles**, **Loans** similarly.
2. **Updating Data**

   ```sql
   UPDATE Books
   SET title = 'The Oracle at Delphi'
   WHERE book_id = 1;
   COMMIT;
   ```

   - Example of correcting a book title.
3. **Deleting Data**

   ```sql
   DELETE FROM BookAuthors WHERE author_id = 2;
   DELETE FROM Authors WHERE author_id = 2;
   COMMIT;
   ```

   - Demonstrates removing an author and their associated records in the join table.

### 4.4 TCL (Transaction Control Language)

Transaction Control Language statements manage how changes are committed or rolled back:

1. **SAVEPOINT**

   ```sql
   SAVEPOINT before_loan;
   ```

   - Marks a transaction point to which you can roll back.
2. **ROLLBACK**

   ```sql
   ROLLBACK TO before_loan;
   ```

   - Reverts all changes back to the state at `before_loan`.
3. **COMMIT**

   - Finalizes all changes in the current transaction.

Example:

```sql
SAVEPOINT before_loan;
INSERT INTO Loans (book_id, member_id, loan_date, return_date, created_at)
VALUES (3, 2, SYSDATE, NULL, SYSDATE);

-- If something goes wrong:
-- ROLLBACK TO before_loan;

COMMIT;
```

---

## 5. Queries and Explanations

Below are **key queries** demonstrating how the data can be retrieved and analyzed. Some sample results are included in screenshots.

1. **Retrieve All Books with Category Names**

   ```sql
   SELECT b.book_id,
          b.title,
          c.category_name,
          b.price,
          b.rating
   FROM Books b
   LEFT JOIN Categories c ON b.category_id = c.category_id;
   ```

   - **Explanation**:
     - Uses a **LEFT JOIN** to list all books even if a category is not assigned.
     - Shows how to combine data from two tables for more meaningful output.
2. **Loans Created in the Past 7 Days**

   ```sql
   SELECT *
   FROM Loans
   WHERE created_at >= SYSDATE - 7;
   ```

   - **Explanation**:
     - Filters loans that have `created_at` within the last 7 days.
     - Useful for weekly transaction reports or overdue checks.
3. **Top 5 Highest Priced Books per Category**

   ```sql
   SELECT book_id, title, category_id, price, rating
   FROM (
       SELECT b.*,
              ROW_NUMBER() OVER (PARTITION BY b.category_id ORDER BY b.price DESC) AS rn
       FROM Books b
   ) 
   WHERE rn <= 5;
   ```

   - **Explanation**:
     - Uses **analytic functions** (`ROW_NUMBER()`) partitioned by category to rank books in descending order by price.
     - Retrieves the top 5 per category.
4. **Members with More Than 3 Loan Transactions**

   ```sql
   SELECT m.member_id, m.name, COUNT(l.loan_id) AS total_loans
   FROM Members m
   JOIN Loans l ON m.member_id = l.member_id
   GROUP BY m.member_id, m.name
   HAVING COUNT(l.loan_id) > 3;
   ```

   - **Explanation**:
     - Groups loans by member to count how many times each member has borrowed.
     - Filters out only those with `COUNT(l.loan_id) > 3`.
5. **Books Loaned by Members with a Specific Email Domain**

   ```sql
   SELECT *
   FROM Books
   WHERE book_id IN (
       SELECT DISTINCT l.book_id
       FROM Loans l
       JOIN Members m ON l.member_id = m.member_id
       WHERE m.email LIKE '%@example.com'
   );
   ```

   - **Explanation**:
     - Demonstrates a **subquery** to find books loaned by members whose emails end in `@example.com`.
6. **Books Loaned More Than 3 Times**

   ```sql
   SELECT 
       b.book_id,
       b.title,
       c.category_name,
       COUNT(*) AS loan_count
   FROM Books b
   JOIN Loans l ON b.book_id = l.book_id
   JOIN Categories c ON b.category_id = c.category_id
   GROUP BY b.book_id, b.title, c.category_name
   HAVING COUNT(*) > 3;
   ```

   - **Explanation**:
     - Identifies popular books that have been borrowed frequently.
     - Could inform decisions about purchasing additional copies.
7. **Detailed View of Transactions for Members with More Than 3 Loans**

   ```sql
   SELECT 
       m.member_id,
       m.name,
       b.title,
       l.loan_date,
       l.return_date,
       CASE 
           WHEN l.return_date IS NULL THEN 'Active'
           ELSE 'Returned'
       END AS loan_status
   FROM Members m
   JOIN Loans l ON m.member_id = l.member_id
   JOIN Books b ON l.book_id = b.book_id
   WHERE m.member_id IN (
       SELECT member_id
       FROM Loans
       GROUP BY member_id
       HAVING COUNT(*) > 3
   )
   ORDER BY m.member_id, l.loan_date;
   ```

   - **Explanation**:
     - Combines members, loans, and books to show a complete transaction history for those members with more than 3 loans.
     - Adds a **computed column** (`loan_status`) indicating whether the loan is still active or returned.

---

## 6. Screenshots and Demonstrations

1. **Conceptual Diagram**

   - Shown above (`/conceptual-diagram.png`). As well the codes for it are in ('/library.mmd')
2. **Open PDB Container**-Show above ('/namechange.png')
   It's listed in the file name [sql_test_script.sql]
3. **Query Results**
   -shown above ('/tablescreated1.png')
   -shown above ('/tablescreated2.png')

# All query results were put in a file name (sql_test_script.sql)#

  The file contains all the project work from the beginning till completion of everything, plus it being systematic.

---

## 7. Explanation of Results and Transactions

### 7.1 Query Results

- **Members with More Than 3 Loans**:
  - Identifies frequent borrowers, potentially for loyalty programs or membership level upgrades.
- **Top 5 Highest Priced Books**:
  - Useful for budgeting or security measures, as these might require special handling.
- **Loans in the Past 7 Days**:
  - Assists librarians in monitoring recent activity, overdue returns, or trending titles.

### 7.2 Transaction Control

- **SAVEPOINT** / **ROLLBACK** / **COMMIT**:
  - Illustrates how partial changes can be undone if something goes wrong during the insertion or deletion process.
  - Ensures data consistency by allowing fine-grained control over each transaction.

Example scenario:

1. A user tries to insert a new loan record.
2. A check reveals the member already has too many active loans.
3. The system issues a `ROLLBACK TO before_loan` to undo that insertion.

Alternatively, if the insertion is valid, a `COMMIT` finalizes the transaction.

---

## 8. How to Run

1. **Connect to Oracle**
   - Make sure your Oracle database is up and the PDB is open in **READ WRITE** mode.
   - Example:
     ```sql
     ALTER PLUGGABLE DATABASE PDB26798 OPEN READ WRITE;
     ALTER SESSION SET CONTAINER = PDB26798;
     ```
2. **Run the DDL**
   - Execute the CREATE TABLE statements in the correct order (Categories, Books, Authors, BookAuthors, Members, MemberProfiles, Loans).
3. **Run the DCL**
   - Create the user and grant the necessary privileges.
4. **Run the DML**
   - Insert sample data for Categories, Books, Authors, BookAuthors, Members, MemberProfiles, Loans.
   - Optionally run any `UPDATE` or `DELETE` statements.
5. **Run the Queries**
   - Verify the data by executing the provided SELECT statements.
   - Confirm results match expectations.
6. **Test Transaction Control**
   - Experiment with `SAVEPOINT`, `ROLLBACK`, and `COMMIT` to ensure partial rollbacks work as intended.

---

## 9. Conclusion

This Library Management System showcases:

- **Relational design** with **one-to-many**, **many-to-many**, and **one-to-one** relationships.
- **Data integrity** enforced via primary and foreign key constraints.
- **User privileges** and best practices in Oracle for controlling data access.
- **Transaction management** using `SAVEPOINT`, `ROLLBACK`, and `COMMIT` to maintain consistent data states.
- **Comprehensive queries** to generate meaningful insights (e.g., frequent borrowers, popular books, recent transactions).

By following this guide, you can recreate the schema, populate data, and run advanced queries to analyze and manage a typical library’s operational data.

> **Tip**: Always keep backups or version-controlled scripts to restore your database quickly if an error occurs.

**Thank you for exploring this Library Management System!**
